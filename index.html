// --- index.js ---

// Marzipano viewer үүсгэх
var viewerOpts = {};
var viewer = new Marzipano.Viewer(document.getElementById('pano'), viewerOpts);

// Scenes үүсгэх код (жишээ, чиний одоогийн data.js ашиглана)
var scenes = [];

for (var i = 0; i < data.scenes.length; i++) {
  var sceneData = data.scenes[i];
  
  var source = Marzipano.ImageUrlSource.fromString(sceneData.image);
  var geometry = new Marzipano.EquirectGeometry([{ width: 4000 }]);
  var limiter = Marzipano.RectilinearView.limit.traditional(1024, 100*Math.PI/180);
  var view = new Marzipano.RectilinearView(sceneData.initialView, limiter);
  
  var scene = viewer.createScene({
    source: source,
    geometry: geometry,
    view: view,
    pinFirstLevel: true
  });

  scenes.push(scene);
}

// Эхний scene-ийг ачаална
scenes[0].switchTo();

// --- Scene шилжүүлэх товчуудын event ---
var sceneElements = document.querySelectorAll('.scene');
sceneElements.forEach(function(el, idx){
  el.addEventListener('click', function(){
    scenes[idx].switchTo();
  });
});

// --- Motion sensor (Gyroscope) Control нэмэх ---
function enableGyroControl(viewer) {
  var controls = viewer.controls();
  var deviceControl = new Marzipano.DeviceOrientationControl();

  if (typeof DeviceOrientationEvent !== 'undefined' &&
      typeof DeviceOrientationEvent.requestPermission === 'function') {
    
    var button = document.createElement('button');
    button.innerHTML = "Enable Motion Control";
    button.style.position = "absolute";
    button.style.top = "10px";
    button.style.left = "10px";
    button.style.zIndex = 9999;
    document.body.appendChild(button);

    button.addEventListener('click', function() {
      DeviceOrientationEvent.requestPermission().then(function(response) {
        if (response === 'granted') {
          controls.addMethod('device', deviceControl);
          controls.enableMethod('device');
          button.remove();
        }
      }).catch(console.error);
    });

  } else {
    // Android болон хуучин iOS
    controls.addMethod('device', deviceControl);
    controls.enableMethod('device');
  }
}

// Viewer үүссэний дараа Motion Control идэвхжүүлэх
enableGyroControl(viewer);

